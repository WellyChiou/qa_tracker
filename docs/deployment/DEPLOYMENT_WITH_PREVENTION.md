# 一鍵部署（含自動預防機制）

## 概述

`deploy-to-server.sh` 現在已經整合了前端白屏預防機制，執行部署時會自動設置所有監控和維護任務。

## 使用方法

只需執行一個命令：

```bash
./deploy-to-server.sh
```

這個腳本會自動完成：
1. ✅ 打包專案
2. ✅ 上傳到伺服器
3. ✅ 解壓並部署
4. ✅ **自動設置預防機制**（新增）

## 自動設置的預防機制

部署完成後，會自動設置以下監控任務：

### 1. 前端監控（每 5 分鐘）
- 檢查前端容器狀態
- 檢查文件完整性
- 發現問題時自動修復

### 2. 系統資源監控（每小時）
- 檢查磁盤空間使用情況
- 檢查 Docker 資源使用
- 磁盤空間不足時自動清理

### 3. Docker 清理（每天凌晨 2 點）
- 自動清理未使用的 Docker 資源
- 釋放磁盤空間

## 查看監控狀態

### 查看監控日誌

```bash
# 前端監控日誌
ssh root@38.54.89.136
tail -f /var/log/frontend-monitor.log

# 系統監控日誌
tail -f /var/log/system-monitor.log
```

### 查看定時任務

```bash
ssh root@38.54.89.136
crontab -l
```

### 手動執行工具

```bash
ssh root@38.54.89.136
cd /root/project/work/docker-vue-java-mysql

# 前端監控
./monitor-frontend.sh

# 系統監控
./monitor-system.sh

# Docker 清理
./cleanup-docker.sh

# 前端診斷
./diagnose-frontend.sh

# 前端修復
./fix-frontend.sh
```

## 部署流程

```
┌─────────────────┐
│ 打包專案        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 上傳到伺服器    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 解壓並部署      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 設置預防機制    │ ← 新增
│ - 前端監控      │
│ - 系統監控      │
│ - 自動清理      │
└─────────────────┘
```

## 注意事項

1. **首次部署**：會自動設置所有預防機制
2. **後續部署**：如果監控任務已存在，會跳過設置（避免重複）
3. **預防機制設置失敗**：不會影響部署流程，部署仍會成功完成

## 相關文檔

- [前端故障排除指南](docs/FRONTEND_TROUBLESHOOTING.md)
- [預防機制詳細說明](docs/PREVENTION_GUIDE.md)
- [快速修復指南](FRONTEND_QUICK_FIX.md)

